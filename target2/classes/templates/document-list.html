<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Liste des documents</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #F5F6F5;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 5000px;
            margin: 0 auto;
            background-color: #FFFFFF;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #0055A4;
            font-size: 24px;
            margin-bottom: 20px;
        }
        .message {
            color: #155724;
            background-color: #D4EDDA;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .error {
            color: #D8000C;
            background-color: #FFD2D2;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .table th, .table td {
            padding: 10px;
            border: 1px solid #dee2e6;
            text-align: left;
        }
        .table th {
            background-color: #0055A4;
            color: #FFFFFF;
        }
        .table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .nav-links {
            margin-top: 20px;
        }
        .nav-links a {
            color: #0055A4;
            text-decoration: none;
            margin-right: 15px;
            font-weight: 500;
        }
        .nav-links a:hover {
            text-decoration: underline;
        }
        .filter-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .filter-container input, .filter-container select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }
        .filter-container input {
            flex-grow: 1;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 20px;
        }
        .pagination button {
            background-color: #0055A4;
            color: #FFFFFF;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .pagination button:hover {
            background-color: #003087;
        }
        .pagination button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .pagination button.active {
            background-color: #003087;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Liste des documents</h1>
    <div th:if="${message}" class="message" th:text="${message}"></div>
    <div th:if="${error}" class="error" th:text="${error}"></div>

    <!-- Barre de recherche et filtre par type -->
    <div class="filter-container">
        <input type="text" id="searchInput" placeholder="Rechercher par titre..." onkeyup="filterAndPaginate()">
        <select id="typeFilter" onchange="filterAndPaginate()">
            <option value="">Tous les types</option>
            <option value="File">File</option>
            <option value="Picture">Picture</option>
            <option value="Note">Note</option>
        </select>
    </div>

    <!-- Tableau des documents -->
    <table class="table" id="documentTable">
        <thead>
        <tr>
            <th>UID</th>
            <th>Titre</th>
            <th>Chemin</th>
            <th>Type</th>
        </tr>
        </thead>
        <tbody id="documentBody">
        <tr th:each="doc : ${documents}" class="document-row">
            <td th:text="${doc.uid}"></td>
            <td th:text="${doc.title}"></td>
            <td th:text="${doc.path}"></td>
            <td th:text="${doc.type}"></td>
        </tr>
        </tbody>
    </table>

    <!-- Contrôles de pagination -->
    <div class="pagination" id="paginationControls"></div>

    <div class="nav-links">
        <a th:href="@{/nuxeo}"><i class="fas fa-home"></i> Retour au tableau de bord</a>
    </div>
</div>

<script>
    const itemsPerPage = 10;
    let currentPage = 1;
    let filteredRows = [];

    function filterAndPaginate() {
        const searchInput = document.getElementById('searchInput').value.toLowerCase();
        const typeFilter = document.getElementById('typeFilter').value;
        const rows = document.querySelectorAll('#documentTable .document-row');

        // Filtrer les lignes
        filteredRows = Array.from(rows).filter(row => {
            const title = row.cells[1].textContent.toLowerCase();
            const type = row.cells[3].textContent;
            const matchesSearch = title.includes(searchInput);
            const matchesType = typeFilter === '' || type === typeFilter;
            return matchesSearch && matchesType;
        });

        // Réinitialiser à la première page lors d'un nouveau filtrage
        currentPage = 1;
        updatePagination();
    }

    function updatePagination() {
        const totalPages = Math.ceil(filteredRows.length / itemsPerPage);
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;

        // Masquer toutes les lignes
        document.querySelectorAll('#documentTable .document-row').forEach(row => {
            row.style.display = 'none';
        });

        // Afficher les lignes de la page actuelle
        filteredRows.slice(startIndex, endIndex).forEach(row => {
            row.style.display = '';
        });

        // Mettre à jour les contrôles de pagination
        const paginationControls = document.getElementById('paginationControls');
        paginationControls.innerHTML = '';

        // Bouton Précédent
        const prevButton = document.createElement('button');
        prevButton.textContent = 'Précédent';
        prevButton.disabled = currentPage === 1;
        prevButton.onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                updatePagination();
            }
        };
        paginationControls.appendChild(prevButton);

        // Boutons de numéro de page
        for (let i = 1; i <= totalPages; i++) {
            const pageButton = document.createElement('button');
            pageButton.textContent = i;
            pageButton.className = i === currentPage ? 'active' : '';
            pageButton.onclick = () => {
                currentPage = i;
                updatePagination();
            };
            paginationControls.appendChild(pageButton);
        }

        // Bouton Suivant
        const nextButton = document.createElement('button');
        nextButton.textContent = 'Suivant';
        nextButton.disabled = currentPage === totalPages || totalPages === 0;
        nextButton.onclick = () => {
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination();
            }
        };
        paginationControls.appendChild(nextButton);
    }

    // Initialiser le filtrage et la pagination au chargement
    document.addEventListener('DOMContentLoaded', () => {
        filterAndPaginate();
    });
</script>
</body>
</html>